# 《良心防线》实施指南 - 第一部分：概述与准备

> 本文档将带你从零开始，一步一步用 CYFramework 实现《良心防线：公司保卫战》。
> 每一步都会告诉你：**做什么 → 改哪个文件 → 写什么代码**。

---

## 一、游戏核心玩法回顾

在动手之前，先用最简单的话说清楚这个游戏是什么：

```
你是"良心老板"，在战场上跑来跑去。
你招募"员工"（友军单位），用资金培养他们。
敌人一波一波从四面八方涌来，攻击你的基地。
你要指挥员工防守，活到最后一波。
```

**核心循环**：
1. 招募员工（Lv1，很弱）
2. 花钱升级员工（Lv2 获得自动技能，战斗力暴涨）
3. 继续培养（Lv3 消除负面词条，Lv4 加正面词条，Lv5 成为传奇可当副官）
4. 用员工抵挡波次，活下来

---

## 二、实现路线图（总览）

我们把整个游戏分成 **7 个阶段**，每个阶段都能"跑起来看到效果"：

| 阶段 | 目标 | 预计工作量 |
|------|------|-----------|
| **阶段 0** | 框架能跑，场景有东西 | 1小时 |
| **阶段 1** | 最简战斗：1种员工 vs 1种敌人，能打能死 | 1-2天 |
| **阶段 2** | 老板角色：能移动、能拾取、能下指令 | 1-2天 |
| **阶段 3** | 波次系统：敌人分波刷新，有预警 | 1天 |
| **阶段 4** | 员工养成：Lv1→Lv5，解锁技能 | 2-3天 |
| **阶段 5** | 词条系统：负面/正面词条影响战斗 | 2天 |
| **阶段 6** | UI与流程：招募界面、商店、结算 | 3-5天 |
| **阶段 7** | 扩展内容：更多职业、敌人、圣物、事件 | 持续 |

**原则：先做能玩的最小版本，再一点点加内容。**

---

## 三、阶段 0：让框架跑起来

### 目标
按下 Play，能看到场景里有东西在动，控制台有日志输出。

### 步骤

#### 0.1 创建游戏场景（2D）

1. 在 Unity 中，`File → New Scene`，选择 **2D** 模板，保存为 `Assets/Scenes/GameScene.unity`
2. 确认 Camera 是 **Orthographic**（正交）模式
3. 创建背景（可选）：
   - `GameObject → 2D Object → Sprite → Square`
   - 命名为 `Background`
   - Scale: (20, 15, 1)（覆盖整个画面）
   - Order in Layer: -100（确保在最底层）
   - 颜色设为浅灰色或你喜欢的背景色

#### 0.2 挂载框架入口

1. 创建空物体：`GameObject → Create Empty`，命名为 `CYFramework`
2. 添加组件：`Add Component → CYFrameworkEntry`
3. 在 Inspector 里，保持默认设置即可

#### 0.3 挂载示例游戏（可选，用于验证）

1. 在同一个 `CYFramework` 物体上，`Add Component → SampleGame`
2. 设置参数：
   - Enemy Count: 3（先少一点）
   - Spawn Radius: 5

#### 0.4 运行测试

1. 按 Play
2. 你应该看到：
   - 场景中出现 1 个绿色方块（玩家）和 3 个红色方块（敌人）
   - 控制台输出：`[GameplayWorld] 玩法世界初始化完成`
3. 按空格键，会攻击最近的敌人

**如果能看到这些，阶段 0 完成！**

---

## 四、阶段 1：最简战斗

### 目标
- 用《良心防线》的数据替换 SampleGame
- 实现 1 个员工职业（金牌骑手 F01）
- 实现 1 种敌人（卷王尸骸 E01）
- 能互相攻击、能死亡

### 1.1 创建数据结构

我们需要定义"员工"和"敌人"的数据。

**创建文件**：`Assets/Scripts/LiangXin/Data/UnitConfig.cs`

```csharp
using UnityEngine;

namespace LiangXin.Data
{
    /// <summary>
    /// 单位配置（员工或敌人的静态数据）
    /// </summary>
    [CreateAssetMenu(fileName = "UnitConfig", menuName = "良心防线/单位配置")]
    public class UnitConfig : ScriptableObject
    {
        [Header("基础信息")]
        public string unitId;           // 如 "F01" 或 "E01"
        public string unitName;         // 如 "金牌骑手"
        public bool isEnemy;            // true = 敌人, false = 友军

        [Header("Lv1 基础属性")]
        public int baseHp = 100;        // 生命值
        public int baseAtk = 10;        // 攻击力
        public float baseMoveSpeed = 3f;// 移动速度
        public float baseAtkRange = 2f; // 攻击范围
        public float baseAtkSpeed = 1f; // 攻击间隔（秒）

        [Header("成长（每级增加）")]
        public int hpPerLevel = 20;
        public int atkPerLevel = 5;

        [Header("表现（2D）")]
        public GameObject prefab;       // 可视化预制体（可为空，用默认色块）
        public Sprite sprite;           // 静态图片（没有prefab时用这个）
        public Color unitColor = Color.white;
        public float spriteScale = 1f;  // 图片缩放
    }
}
```

### 1.2 创建第一个员工配置

1. 在 `Assets/Data/Units/` 文件夹（没有就创建）
2. 右键 → `Create → 良心防线 → 单位配置`
3. 命名为 `F01_金牌骑手`
4. 填写数据：
   - Unit Id: `F01`
   - Unit Name: `金牌骑手`
   - Is Enemy: `false`
   - Base Hp: `80`（Lv1比较脆）
   - Base Atk: `15`
   - Base Move Speed: `2`（徒步，没车）
   - Base Atk Range: `1.5`（近战）
   - Base Atk Speed: `1`
   - Unit Color: 绿色

### 1.3 创建第一个敌人配置

同样步骤，创建 `E01_卷王尸骸`：
- Unit Id: `E01`
- Unit Name: `卷王尸骸`
- Is Enemy: `true`
- Base Hp: `30`（很脆）
- Base Atk: `5`（伤害低）
- Base Move Speed: `4`（冲得快）
- Base Atk Range: `1`
- Base Atk Speed: `1.5`
- Unit Color: 红色

### 1.4 创建单位管理器

**创建文件**：`Assets/Scripts/LiangXin/UnitManager.cs`

```csharp
using System.Collections.Generic;
using UnityEngine;
using LiangXin.Data;

namespace LiangXin
{
    /// <summary>
    /// 单位管理器：负责加载配置、生成单位
    /// </summary>
    public class UnitManager : MonoBehaviour
    {
        [Header("单位配置列表")]
        public List<UnitConfig> unitConfigs = new List<UnitConfig>();

        // 配置字典（运行时用 ID 快速查找）
        private Dictionary<string, UnitConfig> _configDict;

        private void Awake()
        {
            _configDict = new Dictionary<string, UnitConfig>();
            foreach (var config in unitConfigs)
            {
                if (config != null && !string.IsNullOrEmpty(config.unitId))
                {
                    _configDict[config.unitId] = config;
                }
            }
        }

        /// <summary>
        /// 根据 ID 获取配置
        /// </summary>
        public UnitConfig GetConfig(string unitId)
        {
            _configDict.TryGetValue(unitId, out var config);
            return config;
        }
    }
}
```

### 1.5 把配置挂到场景

1. 在 `CYFramework` 物体上添加 `UnitManager` 组件
2. 把刚才创建的两个配置（F01、E01）拖到 `Unit Configs` 列表里

---

## 五、下一步

阶段 1 的后续步骤（1.6 ~ 1.10）会教你：
- 修改 `SampleGame` 使用这些配置
- 让员工和敌人能真正战斗
- 实现死亡和清理

请查看 **良心防线_实施指南_2_战斗系统.md**。

---

## 附录：项目结构建议

```
Assets/
├── CYFramework/           # 框架代码（不要动）
├── Data/
│   └── Units/             # 单位配置 ScriptableObject
│       ├── F01_金牌骑手.asset
│       └── E01_卷王尸骸.asset
├── Scenes/
│   └── GameScene.unity    # 主游戏场景
├── Scripts/
│   └── LiangXin/          # 你的游戏代码
│       ├── Data/
│       │   └── UnitConfig.cs
│       ├── Systems/       # 自定义子系统
│       └── UnitManager.cs
└── Prefabs/               # 预制体
```
